angular.module("datoniApp.controllers").controller("MenuViewCtrl",function(e,t,o,r,d,i,p,a,c,u,m,s){a.isLoading&&a.$broadcast("loading:hide"),e.menu=!1,e.selectSize=function(t,o,n){4==i.id||3==i.id?p.fromTemplateUrl("pizza-size-popover.html",{scope:e}).then(function(n){e.popover=n,e.popoverItem=o,e.category=i.id,n.show(t)}):e.addItem(t,o,n)},e.addItemWithPrice=function(t,o){t.price=o,a.cart.addItem(t,e.category),e.popover.hide()},e.addSaladSize=function(t){e.popoverItem.price=t,a.cart.addItem(e.popoverItem,i.id),e.popover.hide()},e.addItemWithDressing=function(t,o){var n=angular.copy(e.popoverItem);n.name+=" ("+t+")","3"==n.number&&"undefined"==typeof o?(e.popoverItem=n,p.fromTemplateUrl("salad-size-popover.html",{scope:e}).then(function(t){e.popover.hide(),e.popover=t,t.show(e.lastEvent)})):(a.cart.addItem(n,i.id),e.popover.hide())},e.closeModal=function(){e.modal.hide()},e.sortMenu=function(e){return n=e.number.replace(/a|b/,""),parseInt(n)},e.datoniOpened=function(){return r.isOpen()},"undefined"==typeof a.cart&&(a.cart=new c),e.categoryId=i.id,o.getMenu(e.categoryId).then(function(t){e.menu=t.data}),e.editIngredients=function(t,o){e.editIngredientsWithTemplate("templates/modal-edit-ingredients.html",t,o)},e.editSaladIngredients=function(t,o){e.editIngredientsWithTemplate("templates/modal-edit-salad-ingredients.html",t,o)},e.editIngredientsWithTemplate=function(o,n,r){if(e.product=n,e.hasItem=a.cart.hasItem(n),"undefined"==typeof e.product.defaultIngredients){e.product.defaultIngredients=[];var d=angular.copy(e.product.ingredients);for(var i in d)e.product.ingredients.hasOwnProperty(i)&&e.product.ingredients[i]&&e.product.defaultIngredients.push(i)}for(var i in e.product.ingredients)e.product.ingredients.hasOwnProperty(i)&&(e.product.ingredients[i]=!1);angular.forEach(e.product.defaultIngredients,function(t){e.product.ingredients[t]=!0}),e.product.dressing=null,t.fromTemplateUrl(o,{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t,e.modal.show()})},e.addItemWithIngredients=function(t){console.log(t),a.cart.addItem(t,i.id),e.modal.hide()},e.addItemWithIngredientsDressing=function(t){a.cart.addItem(t,i.id),e.modal.hide()},e.addItem=function(t,o,n){console.log(o),"wein"==o.name.toLowerCase()?(e.popoverItem=o,p.fromTemplateUrl("wine-popover.html",{scope:e}).then(function(o){e.popover=o,o.show(t)})):"145"==o.number||"146"==o.number?(e.popoverItem=o,p.fromTemplateUrl("soda-popover.html",{scope:e}).then(function(o){e.popover=o,o.show(t)})):1==i.id?(e.popoverItem=o,p.fromTemplateUrl("dressing-popover.html",{scope:e}).then(function(o){e.popover=o,o.show(t),e.lastEvent=t})):a.cart.addItem(o,i.id)},e.addSoda=function(t){t&&(e.popoverItem.name+=" ("+t+")"),a.cart.addItem(e.popoverItem,i.id),e.popover.hide(),e.popoverItem.name=e.popoverItem.name.replace(" ("+t+")","")},e.addWine=function(t){e.popoverItem.name="1 Flasche "+t,a.cart.addItem(e.popoverItem,i.id),e.popover.hide()},e.isFavorite=function(e){if("undefined"==typeof e)return!1;var t=m.get("user.favorites",{})["product-"+e.number];return"undefined"!=typeof t},e.toggleFavorites=function(e){var t=m.get("user.favorites",{});"undefined"==typeof t["product-"+e.number]?t["product-"+e.number]={product:e,category:i.id}:delete t["product-"+e.number],m.set("user.favorites",t)}});